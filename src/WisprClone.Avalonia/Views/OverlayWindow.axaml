<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:WisprClone.ViewModels"
        mc:Ignorable="d" d:DesignWidth="420" d:DesignHeight="160"
        x:Class="WisprClone.Views.OverlayWindow"
        x:DataType="vm:OverlayViewModel"
        Title="WisprClone"
        SystemDecorations="None"
        TransparencyLevelHint="Transparent"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ShowActivated="False"
        CanResize="False"
        Width="420" MinHeight="100" Height="100"
        SizeToContent="Height">

    <Window.Styles>
        <!-- Pulse animation for listening state -->
        <Style Selector="Ellipse.listening">
            <Style.Animations>
                <Animation Duration="0:0:0.6" IterationCount="Infinite" PlaybackDirection="Alternate">
                    <KeyFrame Cue="0%">
                        <Setter Property="Opacity" Value="1"/>
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="Opacity" Value="0.4"/>
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <!-- Close button style -->
        <Style Selector="Button.closeButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#80FFFFFF"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style Selector="Button.closeButton:pointerover">
            <Setter Property="Background" Value="#30FFFFFF"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="Button.closeButton:pointerover Path">
            <Setter Property="Fill" Value="White"/>
        </Style>

        <!-- Ghost chip ComboBox style -->
        <Style Selector="ComboBox.ghostChip">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#70FFFFFF"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="MinWidth" Value="50"/>
            <Setter Property="CornerRadius" Value="10"/>
        </Style>
        <Style Selector="ComboBox.ghostChip:pointerover">
            <Setter Property="Background" Value="#15FFFFFF"/>
            <Setter Property="Foreground" Value="#90FFFFFF"/>
        </Style>
        <Style Selector="ComboBox.ghostChip:focus">
            <Setter Property="Background" Value="#20FFFFFF"/>
            <Setter Property="Foreground" Value="#FFFFFF"/>
        </Style>

        <!-- Waveform bar style -->
        <Style Selector="Border.waveBar">
            <Setter Property="Width" Value="3"/>
            <Setter Property="Background" Value="#90FFFFFF"/>
            <Setter Property="CornerRadius" Value="1.5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="1,0"/>
        </Style>
    </Window.Styles>

    <!-- Main Container with rounded corners and shadow -->
    <Border x:Name="MainBorder"
            CornerRadius="12"
            Background="#E6202020"
            BorderBrush="#40FFFFFF"
            BorderThickness="1"
            Margin="10"
            BoxShadow="0 0 15 0 #80000000">

        <Grid RowDefinitions="Auto,*,Auto">
            <!-- Header with status indicator (drag handle) -->
            <Border Grid.Row="0"
                    Padding="12,10"
                    Background="#20FFFFFF"
                    CornerRadius="12,12,0,0"
                    PointerPressed="Border_PointerPressed"
                    Cursor="SizeAll">
                <Grid ColumnDefinitions="Auto,Auto,*,Auto">
                    <!-- Status indicator (animated pulse when listening) -->
                    <Ellipse Grid.Column="0"
                             Width="12" Height="12"
                             Fill="{Binding StatusColor}"
                             Classes.listening="{Binding IsListening}"
                             Margin="0,0,10,0"/>

                    <!-- Waveform visualization (visible only when listening) -->
                    <StackPanel x:Name="WaveformPanel"
                                Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="0,0,10,0"
                                Height="20"
                                IsVisible="{Binding IsListening}">
                        <Border Classes="waveBar" Height="{Binding AudioLevel1}"/>
                        <Border Classes="waveBar" Height="{Binding AudioLevel2}"/>
                        <Border Classes="waveBar" Height="{Binding AudioLevel3}"/>
                        <Border Classes="waveBar" Height="{Binding AudioLevel4}"/>
                        <Border Classes="waveBar" Height="{Binding AudioLevel5}"/>
                    </StackPanel>

                    <!-- Status text and elapsed time -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding StatusText}"
                                   Foreground="#CCFFFFFF"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>

                        <!-- Elapsed time display (visible only when recording) -->
                        <Border IsVisible="{Binding ShowElapsedTime}"
                                Background="#30FFFFFF"
                                CornerRadius="8"
                                Padding="8,2"
                                Margin="10,0,0,0"
                                VerticalAlignment="Center">
                            <TextBlock Text="{Binding ElapsedTimeDisplay}"
                                       Foreground="#DDFFFFFF"
                                       FontSize="12"
                                       FontFamily="Consolas, Courier New, monospace"
                                       VerticalAlignment="Center"/>
                        </Border>
                    </StackPanel>

                    <!-- Header buttons -->
                    <StackPanel Grid.Column="3" Orientation="Horizontal">
                        <!-- Copy button -->
                        <Button x:Name="CopyButton"
                                Classes="closeButton"
                                Click="CopyButton_Click"
                                ToolTip.Tip="Copy text to clipboard"
                                Margin="0,0,4,0">
                            <Path Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"
                                  Fill="#80FFFFFF"
                                  Stretch="Uniform"
                                  Width="12" Height="12"/>
                        </Button>

                        <!-- Close button -->
                        <Button Content="x"
                                Classes="closeButton"
                                Click="CloseButton_Click"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                ToolTip.Tip="Hide overlay (Ctrl+Ctrl to show)"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Transcription text area -->
            <TextBox x:Name="TranscriptionTextBox"
                     Grid.Row="1"
                     Text="{Binding TranscriptionText}"
                     IsReadOnly="True"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Foreground="White"
                     Background="Transparent"
                     BorderThickness="0"
                     FontSize="13"
                     Padding="14,6,14,8"
                     CaretBrush="Transparent"/>

            <!-- Footer with provider and language selectors -->
            <Border Grid.Row="2"
                    Padding="12,6"
                    Background="#15000000"
                    CornerRadius="0,0,12,12">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!-- Provider selector -->
                    <ComboBox Grid.Column="0"
                              Classes="ghostChip"
                              ItemsSource="{Binding AvailableProviders}"
                              SelectedItem="{Binding SelectedProvider}"
                              DropDownOpened="ComboBox_DropDownOpened"
                              DropDownClosed="ComboBox_DropDownClosed"
                              ToolTip.Tip="Speech Provider"/>

                    <!-- Language selector -->
                    <ComboBox Grid.Column="1"
                              Classes="ghostChip"
                              ItemsSource="{Binding AvailableLanguages}"
                              SelectedItem="{Binding SelectedLanguage}"
                              DropDownOpened="ComboBox_DropDownOpened"
                              DropDownClosed="ComboBox_DropDownClosed"
                              HorizontalAlignment="Center"
                              FontWeight="SemiBold"
                              ToolTip.Tip="Recognition Language"/>

                    <!-- Hotkey hint -->
                    <TextBlock Grid.Column="2"
                               Text="Ctrl+Ctrl to toggle"
                               Foreground="#50FFFFFF"
                               FontSize="10"
                               VerticalAlignment="Center"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
